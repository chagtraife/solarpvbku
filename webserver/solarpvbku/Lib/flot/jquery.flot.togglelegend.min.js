(function(e){var b={legend:{toggle:false},toggle:{scale:"visible"}},a=function(n,o,m){var i,p,l,j=n.is("td"),k=e(o.getPlaceholder()).data("togglestate");if(j||(n.parents("td").length)){i=(j?n:n.parents("td"));p=i.parent();l=p.index();if(k.has(l)){m[l].data=m[l].hiddenData;delete m[l].hiddenData;k["delete"](l);d(p)}else{m[l].hiddenData=m[l].data;m[l].data=[];k.add(l);c(p)}e(o.getPlaceholder()).data("togglestate",k);h(o,m)}},c=function(i){i.data("legendopacity",i.css("opacity"));i.css("opacity","0.40")},d=function(i){i.css("opacity",i.data("legendopacity"))},h=function(j,i){j.setData(i);if(j.getOptions().toggle.scale=="visible"){j.setupGrid()}j.draw()},f=function(i){i.hooks.drawSeries.push(function(o,k,m){var n=o.getData(),j=e(o.getPlaceholder()).data("togglestate"),p=false;for(var l=0;l<n.length;l++){if(j.has(l)&&n[l].hiddenData===undefined){n[l].hiddenData=n[l].data;n[l].data=[];p=true}}if(p){h(o,n)}});i.hooks.legendInserted.push(function(o,n){var k=n.find("td"),m=o.getData(),j=e(o.getPlaceholder()).data("togglestate");for(var l=0;l<k.length;l+=2){if(j.has(l/2)){c(e(k[l]).parent())}}n.unbind("click.flot").bind("selectstart",function(p){p.preventDefault();return false}).bind("click.flot",function(p){a(e(p.target),o,m)}).find("td").css("cursor","pointer")})},g=function(j){var i=e(j.getPlaceholder()).data("togglestate");if(typeof i==="undefined"){i=new Set();e(j.getPlaceholder()).data("togglestate",i)}j.hooks.processOptions.push(function(l,k){if(k.legend.toggle){f(l)}})};e.plot.plugins.push({init:g,options:b,name:"toggleLegend",version:"0.5"})}(jQuery));